function Rubric(t){this.scorableItems=t}function ScorableItem(t,e){this.type=t,this.weight=e||0}function ScorableItem_Answerable(t,e,n){ScorableItem.apply(this,arguments),this.answers=n}function Answer(t,e){this.score=t,this.pattern=e}function Answer_TrueFalse(t){Answer.call(this,1,t)}function Answer_ChooseOne(){Answer.apply(this,arguments)}function Answer_ChooseMany(){Answer.apply(this,arguments)}function Answer_FillIn(t,e,n){Answer.call(this,t,e),this.caseSensitive=n}function Answer_Numeric(){Answer.apply(this,arguments)}function Connector(){}function SCORM12Interaction(){}function SCORM12Interaction_TrueFalse(){}function SCORM12Interaction_Choice(){this._map={},this._length=0}function SCORM12Interaction_ChooseOne(){SCORM12Interaction_Choice.apply(this,arguments)}function SCORM12Interaction_ChooseMany(){SCORM12Interaction_Choice.apply(this,arguments)}function SCORM12Interaction_FillIn(){}function SCORM12Interaction_Numeric(){}function SCORM12Interaction_Response(){}function SCORM12Mixin(){this._api=this.findAPI(window),this.interactions={},this.suspendData={interactions:{}}}function SCORM12StaticConnector(){SCORM12Mixin.apply(this,arguments),Connector.apply(this,arguments),this.suspendData.answers={},this.rubric=null,this.rawAnswers={}}requirejs.config({shim:{backbone:{deps:["jquery","underscore"],exports:"Backbone"},bootstrap:{deps:["jquery"]},handlebars:{deps:["jquery"],exports:"Handlebars"},underscore:{exports:"_"}},paths:{backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.10/backbone-min",bootstrap:"//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/bootstrap.min",handlebars:"//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.rc.1/handlebars.min",jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.2/jquery.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.1/underscore-min"}}),define("models/audio",["backbone"],function(t){var e={};return e.PageAudio=t.Model.extend({initialize:function(t){var e=this;return this.audio=t.audio,this.delay=t.delay,void 0===window.Audio?(console.log("This browser does not support HTML5 audio"),this.audio=void 0,void 0):(this.audio.addEventListener("loadeddata",function(){e.trigger("loadeddata",e.audio)}),this.audio.addEventListener("timeupdate",function(){e.trigger("timeupdate",e.audio)}),this.audio.addEventListener("playing",function(){e.trigger("playing")}),this.audio.addEventListener("pause",function(){e.trigger("pause")}),this.audio.addEventListener("canplay",function(){e.trigger("canplay",e.audio)}),void 0)},seekPercent:function(t){this.audio.currentTime=t*this.audio.duration},load:function(){this.audio.load()},start:function(){var t=this;this.delayTimer=setTimeout(function(){t.play()},1e3*this.delay)},play:function(){this.audio.play()},pause:function(){this.audio.pause()},stop:function(){var t=audio.seekable.start();this.audio.currentTime=t}},{rangeToTime:function(t){var e=Math.floor(t/3600),n=Math.floor(t%3600/60),i=Math.floor(t%3600%60);return{h:e,m:n,s:i}},neatTime:function(t){fixed_time=_.map(t,function(t){return e.PageAudio.padTime(t,2)});var n="";return 0!==t.h&&(n+=fixed_time[0]+":"),n+=fixed_time[1]+":"+fixed_time[2]},padTime:function(t,e){var n=(1e15+t+"").slice(-e);return isNaN(n)&&(n="00"),n}}),e}),require(["jquery"],function(t){t.rubric={questions:new Object,answers:new Object,RESTRICTED:/[a-zA-Z0-9._\-,]/},t.rubric.types={true_false:{elems:"input[type=radio], select",restrict:/^(true|false)$/i},choose_one:{elems:"input[type=radio], select",restrict:t.rubric.RESTRICTED},choose_many:{elems:"input[type=checkbox], select[multiple]",restrict:t.rubric.RESTRICTED},fill_in:{elems:"input[type=text], input:not([type])",restrict:/.*/},numeric:{elems:"input[type=number]",restrict:/^[-+]?\d+(\.\d+)?$/},response:{elems:"*",restrict:/.*/}},t.rubric.register=function(e,n){e.inputs.change(function(){var i={text:t(this).val()};if(t(this).is(":checkbox")){i.text=[];var r=t(this).attr("name");t(this).parents().find("[name="+r+"]:checked").each(function(){t.merge(i.text,[t(this).val()])})}e.type.restrict.test(t(this).val())&&t(this).is(e.type.elems)?n&&n(t(this).attr("name"),t.isArray(i.text)?i.text.join(";"):i.text):t(this).val(t(this)[0].defaultvalue)})},t.rubric.set=function(e,n,i){var r=t.map(n.response.split(";"),function(e){return t.trim(e)});t.each(e.inputs,function(){if(t(this).is(":radio")){var e=t.trim(t(this).val())===r[0];t(this).prop("checked",e),i===!0&&e&&t(this).change()}else if(t(this).is(":checkbox")){var e=-1!==t.inArray(t.trim(t(this).val()),r);t(this).prop("checked",e),i===!0&&e&&t(this).change()}else t(this).val(t.trim(n.response))})},t.rubric.initialize=function(e,n,i,r,o){var s=t.rubric.questions[e]={type:t.rubric.types[n],inputs:t('[name="'+e+'"]')},a=t.rubric.answers[e]={response:i||""};t.rubric.register(s,o),t.rubric.set(s,a,r)}}),Rubric.factory=function(t){var e={};return $.each(t,function(){e[this.name]=ScorableItem.factory(this.type,this.weight,this.answers)}),new Rubric(e)},Rubric.prototype.mark=function(t){var e={marks:{},correct:0,incorrect:0,points:0,max:0};return $.each(this.scorableItems,function(n,i){var r=i.mark(t[n]||"");r.correct?e.correct++:e.incorrect++,e.points+=r.points,e.max+=i.weight,e.marks[n]=r}),e.percentage=0===e.max?e.incorrect?0:100:100*(e.points/e.max),e},ScorableItem.factory=function(t,e,n){switch(t){case"true_false":case"choose_one":case"choose_many":case"fill_in":case"numeric":return new ScorableItem_Answerable(t,e,Answer.factory(t,n));case"response":return new ScorableItem(t,e);default:throw new Error("Unknown scorable item type:"+t+e+n)}},ScorableItem.isEmpty=function(t){return void 0===t||null===t||""===$.trim(t)},ScorableItem.prototype.mark=function(t){var e=!ScorableItem.isEmpty(t);return{correct:e,points:e?this.weight:0}},ScorableItem_Answerable.prototype=new ScorableItem,ScorableItem_Answerable.prototype.mark=function(t){var e=0,n=!1;return $.each(this.answers,function(){var i=this.mark(t);i>0&&(n=!0,e=i)}),{correct:n,points:e*this.weight}},Answer.factory=function(t,e){return $.isArray(e)||(e=[e]),$.map(e,function(e){switch(t){case"true_false":return new Answer_TrueFalse(e);case"choose_one":return new Answer_ChooseOne(e.score,e.pattern);case"choose_many":return new Answer_ChooseMany(e.score,e.pattern);case"fill_in":return new Answer_FillIn(e.score,e.pattern,e.case_sensitive);case"numeric":return new Answer_Numeric(e.score,e.pattern);default:throw new Error("Unknown scorable item type: "+t)}})},Answer.prototype.mark=function(){throw new Error("Not implemented")},Answer_TrueFalse.prototype=new Answer,Answer_TrueFalse.prototype.mark=function(t){var e=t===this.pattern||this.pattern&&"true"===t||!this.pattern&&"false"===t;return e?this.score:0},Answer_ChooseOne.prototype=new Answer,Answer_ChooseOne.prototype.mark=function(t){return t===this.pattern?this.score:0},Answer_ChooseMany.prototype=new Answer,Answer_ChooseMany.prototype.mark=function(t){var e=this,n=!1;return $.isArray(t)||(t=(t||"").split(";")),t.length===this.pattern.length&&(n=!0,$.each(t,function(){return-1===$.inArray(this.toString(),e.pattern)?(n=!1,!1):void 0})),n?this.score:0},Answer_FillIn.prototype=new Answer,Answer_FillIn.prototype.mark=function(t){var e=this.caseSensitive?t===this.pattern:(t||"").toLowerCase()===this.pattern.toLowerCase();return e?this.score:0},Answer_Numeric.prototype=new Answer,Answer_Numeric.prototype.mark=function(t){var e;return t=parseFloat(t),e="number"==typeof this.pattern?t===this.pattern:(void 0===this.pattern.min||t>=this.pattern.min)&&(void 0===this.pattern.max||t<=this.pattern.max),e?this.score:0},Connector.prototype.run=function(){var t=this;$(window).unload(function(){t.shutdown()}),this.requestMetadata().done(function(e){t.parseMetadata(e)})},Connector.prototype.shutdown=function(){},Connector.prototype.requestMetadata=function(){throw"Not implemented"},Connector.prototype.parseMetadata=function(t){var e=this;$.each(t.rubric,function(){e.addScorableItem(this.name,this.type,this.value)})},Connector.prototype.addScorableItem=function(t,e,n){var i=this;return $.rubric.initialize(t,e,n,this.singlesco,function(t,e){i.requestAnswer(t,e).done(function(n){i.parseAnswer(t,e,n)})}),this},Connector.prototype.requestAnswer=function(){throw"Not implemented"},Connector.prototype.parseAnswer=function(t,e,n){if(!n.success)throw"Error when submitting answer: "+n.messages.join(", ")},SCORM12Interaction.factory=function(t,e){switch(e){case"true_false":return new SCORM12Interaction_TrueFalse;case"choose_one":return(new SCORM12Interaction_ChooseOne).map(t);case"choose_many":return(new SCORM12Interaction_ChooseMany).map(t);case"fill_in":return new SCORM12Interaction_FillIn;case"numeric":return new SCORM12Interaction_Numeric;case"response":return new SCORM12Interaction_Response;default:throw new Error("Unrecognized scorable item type: "+e)}},SCORM12Interaction.prototype.type=function(){return null},SCORM12Interaction.prototype.answer=function(t){return null===t||void 0===t?"":$.trim(t)},SCORM12Interaction.prototype.pattern=function(){return[]},SCORM12Interaction_TrueFalse.prototype=new SCORM12Interaction,SCORM12Interaction_TrueFalse.prototype.type=function(){return"true-false"},SCORM12Interaction_TrueFalse.prototype.answer=function(t){return""===t||null===t||void 0===t?"":"false"===t?"f":t?"t":"f"},SCORM12Interaction_TrueFalse.prototype.pattern=function(t){return[t?"t":"f"]},SCORM12Interaction_Choice.prototype=new SCORM12Interaction,SCORM12Interaction_Choice.prototype.map=function(t){if(void 0===t)return this._map;var e=this;return this._map={},this._length=0,$(':input[name="'+t+'"]').each(function(){var t=$.trim($(this).val());if(void 0===e._map[t]){var n=e._length<26?String.fromCharCode(e._length+97):(e._length-26).toString();e._length++,e._map[t]=n}}),this},SCORM12Interaction_Choice.prototype.type=function(){return this._length<=36?"choice":"performance"},SCORM12Interaction_ChooseOne.prototype=new SCORM12Interaction_Choice,SCORM12Interaction_ChooseOne.prototype.answer=function(t){var e=this._map[$.trim(t)];return void 0===e?"":e},SCORM12Interaction_ChooseOne.prototype.pattern=function(t){var e=this;return $.map(t,function(t){return e._map[t.pattern]})},SCORM12Interaction_ChooseMany.prototype=new SCORM12Interaction_Choice,SCORM12Interaction_ChooseMany.prototype.answer=function(t){var e=this;if("string"!=typeof t)return"";var n=$.map(t.split(";"),function(t){var n=e._map[t];return void 0===n?null:n});return"{"+n.join(",")+"}"},SCORM12Interaction_ChooseMany.prototype.pattern=function(t){var e=this;return $.map(t,function(t){var n=!0,i=[];return $.each(t.pattern,function(){var t=e._map[this];return void 0===t?(n=!1,!1):(i.push(t),void 0)}),n?"{"+i.join(",")+"}":null})},SCORM12Interaction_FillIn.prototype=new SCORM12Interaction,SCORM12Interaction_FillIn.prototype.type=function(){return"fill-in"},SCORM12Interaction_FillIn.prototype.pattern=function(t){return $.map(t,function(t){return $.trim(t.pattern)})},SCORM12Interaction_Numeric.prototype=new SCORM12Interaction,SCORM12Interaction_Numeric.prototype.type=function(){return"numeric"},SCORM12Interaction_Numeric.prototype.answer=function(t){return isNaN(parseFloat(t))?"":t.toString()},SCORM12Interaction_Numeric.prototype.pattern=function(t){return $.map(t,function(t){return"number"==typeof t.pattern?t.pattern.toString():null})},SCORM12Interaction_Response.prototype=new SCORM12Interaction,SCORM12Interaction_Response.prototype.type=function(){return"performance"},SCORM12Interaction_Response.prototype.answer=function(){var t=SCORM12Interaction.prototype.answer.apply(this,arguments);return t.length>255?t.substr(0,252)+"...":t},SCORM12Mixin.OBJECTIVE_ID="Rubric",SCORM12Mixin.mixin=function(t,e){$.each(SCORM12Mixin.prototype,function(e,n){t.prototype[e]=n}),t.prototype.run=function(){this.initSCORM(),this.afterInitSCORM(),e.prototype.run.apply(this,arguments)},t.prototype.shutdown=function(){e.prototype.shutdown.apply(this,arguments),this.shutdownSCORM()},t.prototype.parseMetadata=function(t){e.prototype.parseMetadata.apply(this,arguments),this.parseSCORMMetadata(t)},t.prototype.parseAnswer=function(t,n,i){e.prototype.parseAnswer.apply(this,arguments),this.updateInteraction(t,n,i)}},SCORM12Mixin.prototype.afterInitSCORM=function(){},SCORM12Mixin.prototype.findAPI=function(t){for(;!t.API&&t.parent&&t.parent!==t;)t=t.parent;if(t.API)return t.API;if(t.opener)return this.findAPI(t.opener);throw new Error("Could not find SCORM 1.2 API")},SCORM12Mixin.prototype.setModelValue=function(t,e){var n=this._api.LMSSetValue(t,e);return"true"===n},SCORM12Mixin.prototype.writeSuspendData=function(){return this.setModelValue("cmi.suspend_data",JSON.stringify(this.suspendData))},SCORM12Mixin.prototype.initSCORM=function(){this._api.LMSInitialize("");var t=this._api.LMSGetValue("cmi.suspend_data");""!==t&&(this.suspendData=$.parseJSON(t));var e=this._api.LMSGetValue("cmi.core.lesson_location");return""!==e&&(this.lessonLocation=e),this},SCORM12Mixin.prototype.shutdownSCORM=function(){return this.writeSuspendData(),window.clearInterval(this.intervalID),this.updateSessionTime(),this._api.LMSCommit(""),this._api.LMSFinish(""),this},SCORM12Mixin.prototype.parseSCORMMetadata=function(t){this.initObjective(),this.syncInteractions(t.rubric),this.updateObjective(),this.writeSuspendData(),this._api.LMSCommit("")},SCORM12Mixin.prototype.initObjective=function(){var t=this._api.LMSGetValue("cmi.objectives._count"),e=!1;if(void 0===this.objectives&&this.singlesco===!0){this.objectives={};var n=$("div#course_toc ol li a.sco_nav_link"),i=this;n.each(function(t,e){i.objectives[e.dataset.path]=t});var r=this.objectives[this.path];e=""===this._api.LMSGetValue("cmi.objectives."+r+".id")}if(""===t)throw new Error("Failed to get objective count");return(0>=t||e)&&(this.singlesco===!0?(this.setModelValue("cmi.objectives."+r+".id",SCORM12Mixin.OBJECTIVE_ID+r),this.setModelValue("cmi.objectives."+r+".status","not attempted")):(this.setModelValue("cmi.objectives.0.id",SCORM12Mixin.OBJECTIVE_ID),this.setModelValue("cmi.objectives.0.status","not attempted")),this.setModelValue("cmi.core.lesson_status","incomplete")),this.suspendData.interactions||(this.suspendData.interactions={}),this},SCORM12Mixin.prototype.updateObjective=function(){var t=this,e=0,n=0;for(var i in this.suspendData.interactions)this.isScorableItemCompleted(i)&&e++,n++;var r,o=0;if(this.singlesco===!0&&(o=this.objectives[this.path]),e===n?r="completed":(e>0||"not attempted"!==this._api.LMSGetValue("cmi.objectives."+o+".status"))&&(r="incomplete"),$.each(["cmi.objectives."+o,"cmi.core"],function(){(t.singlesco!==!0||"cmi.core"!=this)&&(r&&t.setModelValue(this+("cmi.core"==this?".lesson_status":".status"),r),$.isEmptyObject(t.suspendData.interactions)?(t.setModelValue(this+".score.min","0"),t.setModelValue(this+".score.max","100"),t.setModelValue(this+".score.raw","100")):(t.setModelValue(this+".score.min","0"),t.setModelValue(this+".score.max","100")))}),this.singlesco===!0){var s=0;for(var a in this.objectives)this.scorables[a]&&(s+=1);var c=[],u=[];if($.each(Object.keys(this.objectives),function(e,n){var i=t.objectives[n],r=t._api.LMSGetValue("cmi.objectives."+i+".score.raw"),o=t._api.LMSGetValue("cmi.objectives."+i+".score.min"),s=t._api.LMSGetValue("cmi.objectives."+i+".score.max"),a=t._api.LMSGetValue("cmi.objectives."+i+".status");if(""!==r&&""!==o&&""!==s){var p=(r-o)/s;t.scorables[n]&&(c.push(p),u.push(a))}}),c.length>0){var p=c.reduce(function(t,e){return t+e})/s;this.setModelValue("cmi.core.score.min","0"),this.setModelValue("cmi.core.score.max","100"),this.setModelValue("cmi.core.score.raw",Math.round(100*p))}if(u.length>0){var h=u.every(function(t){return"completed"===t});h===!0&&u.length===s?this.setModelValue("cmi.core.lesson_status","completed"):this.setModelValue("cmi.core.lesson_status","incomplete")}}return this},SCORM12Mixin.prototype.syncInteractions=function(t){var e=this,n=$.map(t,function(t){return t.name});this.valueSet={},$.each(n,function(t,n){var i=$('[name="'+n+'"]');$.each(i,function(t,n){void 0!==n.value&&(e.valueSet[n.value]=!0,e.valueSet[n.value.replace(/ /g,"_")]=!0)})});for(var i in this.suspendData.interactions)-1===$.inArray(i,n)&&this.removeInteraction(i);$.each(t,function(){e.addInteraction(this.name,this.type,this.value)})},SCORM12Mixin.prototype.addInteraction=function(t,e,n){var i=SCORM12Interaction.factory(t,e),r=this.suspendData.interactions;if(!this.isInteractionDefined(t)){var o=this._api.LMSGetValue("cmi.interactions._count");if(""===o)throw new Error("Failed to get interaction count");r[t]={index:parseInt(o)}}var s=r[t].index,a="cmi.interactions."+s,c=0,u="";return this.singlesco===!0&&(c=this.objectives[this.path],u=c),this.setModelValue(a+".id",this.interactionID(s,t)),this.setModelValue(a+".type",i.type()),this.setModelValue(a+".objectives."+c+".id",SCORM12Mixin.OBJECTIVE_ID+u),this.setModelValue(a+".student_response",i.answer(n)),i instanceof SCORM12Interaction_Choice&&(r[t].choices=i.map()),this.interactions[t]=i,this},SCORM12Mixin.prototype.removeInteraction=function(t){var e=this.suspendData.interactions;if(this.isInteractionDefined(t)){var n=e[t].index;this.setModelValue("cmi.interactions."+n+".id","deleted_"+this.interactionID(n,t)),delete e[t]}return this},SCORM12Mixin.prototype.updateInteraction=function(t,e,n){var i=this;if(!this.isInteractionDefined(t))throw"Scorable item "+t+" not defined";var r=this.interactions[t],o="cmi.interactions."+this.suspendData.interactions[t].index;this.setModelValue(o+".weighting",n.weight.toString()),this.setModelValue(o+".student_response",r.answer(e)),this.setModelValue(o+".result",this.interactionResult(n.correct,n.answers)),$.each(r.pattern(n.answers),function(t){i.setModelValue(o+".correct_responses."+t+".pattern",this)});var s=0;this.singlesco===!0&&(s=this.objectives[this.path]),$.each(["cmi.objectives."+s,"cmi.core"],function(){(i.singlesco!==!0||"cmi.core"!=this)&&i.setModelValue(this+".score.raw",n.score.toString())}),this.updateObjective(),this._api.LMSCommit("")},SCORM12Mixin.prototype.interactionID=function(t,e){return this.singlesco===!0?this.path+"_item"+t+"_"+e.replace(/[^a-z0-9_-]/gi,"_"):"item"+t+"_"+e.replace(/[^a-z0-9_-]/gi,"_")},SCORM12Mixin.prototype.isInteractionDefined=function(t){return void 0!==this.suspendData.interactions[t]},SCORM12Mixin.prototype.interactionResult=function(t,e){var n=t?"correct":"wrong";return t&&void 0===e&&(n="neutral"),n},SCORM12Mixin.prototype.isScorableItemCompleted=function(t){var e=$('[name="'+t+'"]').filter(":not(:radio, :checkbox), :checked").val();return this.valueSet[t]===!0||void 0!==e&&""!==e},SCORM12Mixin.prototype.SCORM12ElapsedSessionTimeString=function(){void 0===this.start_time&&(this.start_time=Date.now());var t=this.parseMillisToSessionTime(Date.now()-this.start_time);return[this.pad("0000",t.hours.toString()),this.pad("00",t.mins.toString()),this.pad("00",t.seconds.toString())].join(":")},SCORM12Mixin.prototype.parseMillisToSessionTime=function(t){var e=t,n=1e3,i=60*n,r=60*i,o={};return o.hours=Math.floor(e/r),e-=r*o.hours,o.mins=Math.floor(e/i),e-=i*o.mins,o.seconds=Math.floor(e/n),o},SCORM12Mixin.prototype.pad=function(t,e){return t.slice(0,t.length-e.length)+e},SCORM12Mixin.prototype.updateSessionTime=function(){this._api.LMSSetValue("cmi.core.session_time",this.SCORM12ElapsedSessionTimeString())},SCORM12StaticConnector.prototype=new Connector,SCORM12Mixin.mixin(SCORM12StaticConnector,Connector),SCORM12StaticConnector.prototype.afterInitSCORM=function(){var t=this,e=$.parseJSON(this._api.LMSGetValue("cmi.launch_data")).rubric;this.rubric=Rubric.factory(e),$.each(e,function(){t.rawAnswers[this.name]=this.answers});var n=this._api.LMSGetValue("cmi.core.student_name").split(","),i=n.shift(),r=n.join(",");$(".user_first_name").text($.trim(r)),$(".user_last_name").text($.trim(i)),$(".user_full_name").text($.trim(r+" "+i))},SCORM12StaticConnector.prototype.requestMetadata=function(){var t=this,e=[];return $.each(this.rubric.scorableItems,function(n,i){e.push({name:n,type:i.type,value:t.suspendData.answers[n]})}),$.Deferred().resolve({rubric:e}).promise()},SCORM12StaticConnector.prototype.requestAnswer=function(t,e){this.suspendData.answers[t]=e,this.writeSuspendData();var n=$.Deferred(),i=this.rubric.scorableItems[t];if(i){var r=this.rubric.mark(this.suspendData.answers);n.resolve({success:!0,messages:[],weight:i.weight,answers:this.rawAnswers[t],correct:r.marks[t].correct,score:r.percentage})}else n.reject({success:!1,messages:["Unknown scorable item: "+t]});return n.promise()},require(["models/audio"],function(t){$(function(){var e=$("audio");if(e.length){e.attr("controls",!0);var n=new t.PageAudio({audio:e.get(0),delay:e.data("delay")});n.start()}})}),$(function(){var t=function r(t){for(;!t.API&&t.parent&&t.parent!==t;)t=t.parent;return t.API?t.API:t.opener?r(t.opener):null},e=$.Deferred(),n=e.promise(),i=setInterval(function(){null!==t(window)&&e.resolve()},1e3);n.done(function(){clearInterval(i),(new SCORM12StaticConnector).run()})});